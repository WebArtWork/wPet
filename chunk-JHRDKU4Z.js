import{a as j,b as k}from"./chunk-BQQUI5CC.js";import{e as M}from"./chunk-7MKG6VHM.js";import{K as s,L as m,M as _,Qa as v,R as f,Sa as w,Wa as g,X as u,bb as y,f as a,hb as C,i as n,ob as S,s as h,vb as b,xb as R}from"./chunk-3B44IZU7.js";var l=(()=>{class o{constructor(e,i,t,c,d,I,P){this._translate=e,this._petrecordService=i,this._alert=t,this._form=c,this._core=d,this._router=I,this._route=P,this.columns=["name","disease","treatment","procedure","notes","description"],this.form=this._form.getForm("petrecord",j),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._petrecordService.setPerPage.bind(this._petrecordService),allDocs:!1,create:this._router.url.includes("records/")?()=>{this._form.modal(this.form,{label:"Create",click:(r,p)=>a(this,null,function*(){p(),this._preCreate(r),yield n(this._petrecordService.create(r)),this.setRows()})})}:null,update:r=>{this._form.modal(this.form,[],r).then(p=>{this._core.copy(p,r),this._petrecordService.update(r)})},delete:r=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this petrecord?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>a(this,null,function*(){yield n(this._petrecordService.delete(r)),this.setRows()})}]})},buttons:[{icon:"cloud_download",click:r=>{this._form.modalUnique("petrecord","url",r)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this.pet_id="",this._page=1,this.setRows(),this._route.paramMap.subscribe(r=>{this.pet_id=r.get("pet_id")||""})}setRows(e=this._page){this._page=e,this._core.afterWhile(this,()=>{this._petrecordService.get({page:e,query:this._query()}).subscribe(i=>{this.rows.splice(0,this.rows.length),this.rows.push(...i)})},250)}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(i=>a(this,null,function*(){if(e)for(let t of i)this._preCreate(t),yield n(this._petrecordService.create(t));else{for(let t of this.rows)i.find(c=>c._id===t._id)||(yield n(this._petrecordService.delete(t)));for(let t of i){let c=this.rows.find(d=>d._id===t._id);c?(this._core.copy(t,c),yield n(this._petrecordService.update(c))):(this._preCreate(t),yield n(this._petrecordService.create(t)))}}this.setRows()}))}}_preCreate(e){delete e.__created,this.pet_id&&(e.pet=this.pet_id)}_query(){let e="";return this.pet_id&&(e+=(e?"&":"")+"pet="+this.pet_id),e}static{this.\u0275fac=function(i){return new(i||o)(s(S),s(k),s(C),s(R),s(y),s(w),s(v))}}static{this.\u0275cmp=m({type:o,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Records",3,"columns","config","rows"]],template:function(i,t){i&1&&u(0,"wtable",0),i&2&&f("columns",t.columns)("config",t.config)("rows",t.rows)},dependencies:[b],encapsulation:2})}}return o})();var F=[{path:"",component:l},{path:":pet_id",component:l}],H=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=_({type:o})}static{this.\u0275inj=h({imports:[g.forChild(F),M]})}}return o})();export{H as RecordsModule};
